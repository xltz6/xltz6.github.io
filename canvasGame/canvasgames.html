<!DOCTYPE html>
<html>
    <body>
        <canvas id="canvas" width="600" height="500"
            style="border:1px solid #c3c3c3;">
        </canvas>
        <br><br>
    </body>
    <script>
       window.requestAnimFrame = (function(){
            return  window.requestAnimationFrame       || 
                window.webkitRequestAnimationFrame || 
                window.mozRequestAnimationFrame    || 
                window.oRequestAnimationFrame      || 
                window.msRequestAnimationFrame     ||  
                function( callback ){
                    return window.setTimeout(callback, 1000 / 60);
                };
        })();

        window.cancelRequestAnimFrame = ( function() {
            return window.cancelAnimationFrame          ||
                window.webkitCancelRequestAnimationFrame    ||
                window.mozCancelRequestAnimationFrame       ||
                window.oCancelRequestAnimationFrame     ||
                window.msCancelRequestAnimationFrame        ||
                clearTimeout
        } )();


        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d"); // Create canvas context
        var W = window.innerWidth; // Window's width
        var H = window.innerHeight; // Window's height
        var ball = {}; // Ball object
        var paddle; // paddle
        var mouse = {}; // Mouse object to store it's current position
        var startBtn = {}; // Start button object
        var restartBtn = {}; // Restart button object
        var over = 0; // flag varialbe, cahnged when the game is over
        var init; // variable to initialize animation
        
        // Add mousemove and mousedown events to the canvas
        canvas.addEventListener("mousemove", trackPosition, true);
        canvas.addEventListener("mousedown", btnClick, true);

        canvas.width = 700;
        canvas.height = 500;

        // Function to paint canvas
        function paintCanvas() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, 700, 500);
        }

        // Function for creating paddle
        paddle = {
            // Height and width and position
            h : 5,
            w : 130,
            x : 700/2 - 130/2,
            y : 500 - 5,
            // Function for drawing paddle on canvas
            draw:function(){
                ctx.fillStyle = "white";
                ctx.fillRect(this.x, this.y, this.w, this.h);
                ctx.fill();
            }
        }

        // Ball object
        ball = {
            x: 50,
            y: 50, 
            r: 5,
            c: "white",
            vx: 4,
            vy: 8,

            // Function for drawing ball on canvas
            draw: function() {
                ctx.beginPath();
                ctx.fillStyle = this.c;
                ctx.arc(this.x, this.y, this.r, 0, Math.PI*2, false);
                ctx.fill();
            }
        };


        // Start Button object
        startBtn = {
            w: 100,
            h: 50,
            x: 700/2 - 50,
            y: 500/2 - 25,

            draw: function() {
                ctx.strokeStyle = "white";
                ctx.lineWidth = "2";
                ctx.strokeRect(this.x, this.y, this.w, this.h);

                ctx.font = "18px Arial, sans-serif";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillStlye = "white";
                ctx.fillText("Start", 700/2, 500/2 );
            }
        };

        // Restart Button object
        restartBtn = {
            w: 100,
            h: 50,
            x: 700/2 - 50,
            y: 500/2 - 50,

            draw: function() {
                ctx.strokeStyle = "white";
                ctx.lineWidth = "2";
                ctx.strokeRect(this.x, this.y, this.w, this.h);

                ctx.font = "18px Arial, sans-serif";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillStlye = "white";
                ctx.fillText("Restart", 700/2, 500/2 - 25 );
            }
        };


        // Draw everything on canvas
        function draw() {
            paintCanvas();
            paddle.draw();
            ball.draw();
            update();
        }

        // Track the position of mouse cursor
        function trackPosition(e) {
            mouse.x = e.pageX;
            mouse.y = e.pageY;
        }

        // Basically, the main game logic is defined here
        function update() {
            // Move the paddles on mouse move
            if(mouse.x && mouse.y) {
                paddle.x = mouse.x - paddle.w/2;
            }

            // Move the ball
            ball.x += ball.vx;
            ball.y += ball.vy;

            if(collides(ball, paddle)) {
                ball.vy = -ball.vy;
            }

            else {
        // Collide with walls, If the ball hits the top/bottom, walls, run gameOver() function
                if(ball.y > 500) {
                    ball.y = 500 - ball.r;
                    gameOver();
                } 

        // If ball strikes the vertical walls, invert the x-velocity vector of ball
                if(ball.x + ball.r > 700) {
                    ball.vx = -ball.vx;
                    ball.x = 700 - ball.r;
                }

                else if(ball.x -ball.r < 0) {
                    ball.vx = -ball.vx;
                    ball.x = ball.r;
                }
                
                else if(ball.y - ball.r < 0){
                    ball.vy = -ball.vy;
                    ball.y = ball.r;
                }
            }
        }

        //Function to check collision between ball and one of the paddles
        function collides(b, p) {
            if(b.x + ball.r >= p.x && b.x - ball.r <=p.x + p.w) {
                if(b.y >= (p.y - p.h) && p.y > 0){
                    return true;
                }
                else return false;
            }
        }

        // Function to run when the game overs
        function gameOver() {
            ctx.fillStlye = "white";
            ctx.font = "20px Arial, sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("Game Over!", 700/2, 500/2 + 25 );

            // Stop the Animation
            cancelRequestAnimFrame(init);
            // Set the over flag
            over = 1;
            // Show the restart button
            restartBtn.draw();
        }

        // Function for running the whole animation
        function animloop() {
            init = requestAnimFrame(animloop);
            draw();
        }

        // Function to execute at startup
        function startScreen() {
            draw();
            startBtn.draw();
        }

        // On button click (Restart and start)
        function btnClick(e) {
            // Variables for storing mouse position on click
            var mx = e.pageX;
            var my = e.pageY;
            // Click start button
            if(mx >= startBtn.x && mx <= startBtn.x + startBtn.w) {
                animloop();
                // Delete the start button after clicking it
                startBtn = {};
            }
	
        // If the game is over, and the restart button is clicked
        if(over == 1) {
            if(mx >= restartBtn.x && mx <= restartBtn.x + restartBtn.w) {
                ball.x = 20;
                ball.y = 20;
                ball.vx = 4;
                ball.vy = 8;
                animloop();
                over = 0;
            }
        }
    }

    // Show the start screen
    startScreen();
    //ball.draw();
    </script>
</html>
